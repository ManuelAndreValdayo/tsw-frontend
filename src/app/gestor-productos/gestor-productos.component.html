<!-- gestor-productos.component.html -->
<div class="buscador">
  <!-- Header y botón de AÑADIR usando sockets -->
  <div class="nombreBuscador flex-space-between align-center">
    <div class="flex align-center">
      <i class="fa-solid fa-magnifying-glass icon-search" aria-hidden="true"></i>
      <p><strong>BUSCADOR PRODUCTOS</strong></p>
    </div>
    <button
      class="contenidoBotonAnadir"
      type="button"
      (click)="openModalAndPrepare(INSERTAR)">
      <i class="fa-solid fa-plus" aria-hidden="true"></i>
      <span>AÑADIR PRODUCTO</span>
    </button>
  </div>

  <!-- Filtro client-side -->
  <div class="contenidoBuscador">
    <div class="contenedorFlex align-center">
      <input
        [(ngModel)]="searchTerm"
        (keyup.enter)="onSearch()"
        type="text"
        placeholder="Nombre producto"
        aria-label="Buscar producto"
      />
      <button
        class="contenidoBotonBuscar"
        type="button"
        (click)="onSearch()">
        BUSCAR
      </button>
    </div>
  </div>
</div>

<!-- Volver a listas y desconectar WS -->
<div
  class="volver flex align-center"
  routerLink="../listas"
  (click)="disconnectWs()"
  aria-label="Volver a listas">
  <i class="fa-solid fa-arrow-left" aria-hidden="true"></i>
  <span><strong>VOLVER</strong></span>
</div>

<section id="contenedorProductos">
  <!-- Encabezado de tabla -->
  <div class="headerProducto flex align-center">
    <div class="acciones"></div>
    <div class="atributo campoFormAncho_70"><strong>NOMBRE</strong></div>
    <div class="atributo campoFormAncho_30"><strong>CANTIDAD</strong></div>
    <div class="info campoFormAncho_10"></div>
  </div>

  <!-- Cada producto usa confirmDelete y openModalAndPrepare -->
  <div
    class="divproducto flex align-center"
    *ngFor="let producto of filteredProductos()">
    <div class="productoAcciones">
      <button
        class="icon-button"
        type="button"
        [attr.aria-label]="'Modificar ' + producto.nombre"
        (click)="openModalAndPrepare(MODIFICAR, producto)">
        <i class="fa-solid fa-pen"></i>
      </button>
      <button
        class="icon-button"
        type="button"
        [attr.aria-label]="'Eliminar ' + producto.nombre"
        (click)="confirmDelete(producto.id)">
        <i class="fa-solid fa-trash"></i>
      </button>
    </div>
    <div class="productoAtributo campoFormAncho_70">
      {{ producto.nombre || 'Sin nombre' }}
    </div>
    <div class="productoAtributo campoFormAncho_30">
      {{ producto.cantidad || 'Sin cantidad' }}
    </div>
    <div class="productoInfo campoFormAncho_10"></div>
  </div>

  <!-- Mensaje cuando no hay nada que mostrar -->
  <div *ngIf="productos.length === 0" class="sinProductos">
    NO SE HAN ENCONTRADO PRODUCTOS
  </div>
</section>

<!-- Modales: alta/edición y advertencia -->
<app-mto-productos
  *ngIf="isModalOpen"
  (modalClose)="closeModal()"
  (modalSave)="onModalSave($event)"
  [tipoAccion]="intAccion"
  [idProducto]="idProducto ?? 0"
  [idLista]="idLista">
</app-mto-productos>

<app-modal-advertencia
  [tipoAdvertencia]="tipoAdvertencia"
  [mensaje]="mensajeModal"
  [mostrar]="mostrarModal"
  (onConfirmar)="eliminarProductoConfirmada()"
  (onCancelar)="cerrarModal()">
</app-modal-advertencia>
